# Generated by Gareth Owen <gaz@athene.co.uk>

CC = clang
CFLAGS = -c -g -emit-llvm -std=c99 -D_GNU_SOURCE
LDFLAGS = 
LIBS = 
DESTDIR = /usr/local/ghttpd

OBJ = main.bc protocol.bc util.bc

default: ghttpd

ghttpd:
	$(CC) $(CFLAGS) *.c
	llvm-link $(OBJ) -o ghttpd


install: ghttpd
	mkdir -p $(DESTDIR)
	mkdir -p $(DESTDIR)/cgi-bin
	mkdir -p $(DESTDIR)/htdocs
	cp -f ghttpd $(DESTDIR)/
	cp -f 404.html $(DESTDIR)/
	cp -f cgierror.html $(DESTDIR)/
	cp -f cmderror.html $(DESTDIR)/
	cp -f ghttpd.conf /etc/
	cp -f index.html $(DESTDIR)/htdocs/
	chown nobody.nobody $(DESTDIR)
	chown nobody.nobody $(DESTDIR)/*
	chown nobody.nobody $(DESTDIR)/htdocs/*

clean:
	rm -f *.o ghttpd

